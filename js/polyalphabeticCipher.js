// poly alphabets
var levelA = ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z"];
var levelB = ["b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "a"];
var levelC = ["c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "a", "b"];
var levelD = ["d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "a", "b", "c"];
var levelE = ["e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "a", "b", "c", "d"];
var levelF = ["f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "a", "b", "c", "d", "e"];
var levelG = ["g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "a", "b", "c", "d", "e", "f"];
var levelH = ["h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "a", "b", "c", "d", "e", "f", "g"];
var levelI = ["i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "a", "b", "c", "d", "e", "f", "g", "h"];
var levelJ = ["j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "a", "b", "c", "d", "e", "f", "g", "h", "i"];
var levelK = ["k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j"];
var levelL = ["l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k"];
var levelM = ["m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l"];
var levelN = ["n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m"];
var levelO = ["o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n"];
var levelP = ["p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o"];
var levelQ = ["q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p"];
var levelR = ["r", "s", "t", "u", "v", "w", "x", "y", "z", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q"];
var levelS = ["s", "t", "u", "v", "w", "x", "y", "z", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r"];
var levelT = ["t", "u", "v", "w", "x", "y", "z", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s"];
var levelU = ["u", "v", "w", "x", "y", "z", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t"];
var levelV = ["v", "w", "x", "y", "z", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u"];
var levelW = ["w", "x", "y", "z", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v"];
var levelX = ["x", "y", "z", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w"];
var levelY = ["y", "z", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x"];
var levelZ = ["z", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y"];

// puts all alphabets in an array
var polyalphabeticTable = [levelA, levelB, levelC, levelD, levelE, levelF, levelG, levelH, levelI, levelJ, levelK, levelL, levelM, levelN, levelO, levelP, levelQ, levelR, levelS, levelT, levelU, levelV, levelW, levelX, levelY, levelZ];



// returns the positon of the letter to be encoded
function letterPosition(letter){
  for (var i = 0; i < 26; i++) {
    if(levelA[i] == letter){
      return i;
    }
  }
}
// returns a position of encoded letter given the level
function encodedLetterPosition(letter, level){
  for (var i = 0; i < 26; i++) {
    if(polyalphabeticTable[level][i] == letter){
      return i;
    }
  }
}

// changes the key (word) into array of positions
function decodeKey(key){
  var decodedKey = [];
  for (var i = 0; i < key.length; i++) {
    decodedKey.push(letterPosition(key[i].toLowerCase()));
  }
  return decodedKey;
}

function isLetter(char) {
  return char.match(/[a-z]/i);
}
// encodes a message according to provided key
// works similar to Caesar cipher but instead of just one number it uses a combination of them
function encodeMessage(message, key){
  var result = "";
  var decodedKey = decodeKey(key);
  var index = 0; //  the position of the number from the key
  var keyLastPosition = key.length - 1;
  for (var i = 0; i < message.length; i++) {
    var keyPosition = decodedKey[index]; // represents the appropriate table to be used (from 26 tables)
    if(message[i] == " "){ // spaces are not encripted
      result = result.concat(message[i]);
      continue;
    }
    if(!isLetter(message[i])){
      continue;
    }
    var letterPos = letterPosition(message[i].toLowerCase());
    // selects a letter from the correct table at the same position as the letter to be encoded
    var encodedChar = polyalphabeticTable[keyPosition][letterPos];
    result += encodedChar;
    if(index == keyLastPosition){
      index = 0;
    }else{
      index++;
    }
  }
  return result;
}



// decodes a message
function decodeMessage(message, key){
  var result = "";
  var decodedKey = decodeKey(key);
  var index = 0;

  var keyLastPosition = key.length - 1;
  for (var i = 0; i < message.length; i++) {
    var keyPosition = decodedKey[index]; // checks which table was used to encode the letter
    var char = message[i];
    if(message[i] == " "){
      result = result.concat(char);
      continue;
    }

    var letterPos = encodedLetterPosition(message[i], keyPosition); // checks at which position was the encoded letter
    var decodedChar = polyalphabeticTable[0][letterPos]; // selects a letter from the 1st (not encoded) table
    result += decodedChar;
    if(index == keyLastPosition){
      index = 0;
    }else{
      index++;
    }
  }
  return result;
}



// gets the message and key entered by user and ciphers it
function cipherButtonFunction(){
  var enteredKey = document.getElementById('enteredKey').value;
  var message = document.getElementById("inputMessage").value;
  if(enteredKey == "" || message == ""){
    alert("Please enter key and message to de ciphered/deciphered!");
    return;
  }


  var result = encodeMessage(message, enteredKey);
  document.getElementById("result").value = result;


}

// gets the message and key entered by user and deciphers it
function decipherButtonFunction(){
  var enteredKey = document.getElementById('enteredKey').value;
  var message = document.getElementById("inputMessage").value;

  if(enteredKey == "" || message == ""){
    alert("Please enter key and message to de ciphered/deciphered!");
    return;
  }

  var result = decodeMessage(message, enteredKey);
  document.getElementById("result").value = result;
}